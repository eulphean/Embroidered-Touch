(this.webpackJsonpFabricInstrument=this.webpackJsonpFabricInstrument||[]).push([[0],{100:function(e,t,n){e.exports=n(151)},105:function(e,t,n){},106:function(e,t,n){},151:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),s=n(66),o=n.n(s),c=(n(105),n(106),n(1)),r=n(2),l=n(12),u=n(11),h=n(6),f=n(67),p=n.n(f),d=n(68),v=n.n(d),m=new(function(){function e(){Object(c.a)(this,e),this.socket=v()("https://fabric-backend.herokuapp.com/app",{reconnection:!0,reconnectionDelay:500,reconnectionAttempts:1/0}),this.socket.once("connect",this.subscribe.bind(this)),this.canBroadcast=!1,this.sensorDataCallback="",this.readAllConfigCallback=""}return Object(r.a)(e,[{key:"subscribe",value:function(){console.log("Connected"),this.socket.on("time",this.logTime.bind(this)),this.socket.on("receiveSensorData",this.handleSensorData.bind(this)),this.socket.on("receiveAllConfigs",this.handleAllConfigs.bind(this))}},{key:"updateRoom",value:function(e){this.socket.emit("room"),this.canBroadcast=!this.canBroadcast,this.sensorDataCallback=e}},{key:"broadcastText",value:function(e){this.canBroadcast&&this.socket.emit("sensorData",e)}},{key:"handleSensorData",value:function(e){this.sensorDataCallback(e)}},{key:"saveUserConfig",value:function(e){this.socket.emit("saveUserConfig",e)}},{key:"updateUserConfig",value:function(e){this.socket.emit("updateUserConfig",e)}},{key:"deleteUserConfig",value:function(e){this.socket.emit("deleteUserConfig",e)}},{key:"requestForConfigs",value:function(e){this.readAllConfigCallback=e,this.socket.emit("requestForConfigs")}},{key:"handleAllConfigs",value:function(e){this.readAllConfigCallback(e)}},{key:"disconnect",value:function(){console.log("Socket Server Disconnected.")}},{key:"logTime",value:function(e){}}]),e}()),g=new(function(){function e(){Object(c.a)(this,e),this.cutoffVals=[{co:new Array(12).fill(150)},{co:new Array(12).fill(150)}],this.configs={},this.listeners=[],m.requestForConfigs(this.onAllConfigsLoaded.bind(this))}return Object(r.a)(e,[{key:"subscribe",value:function(e){var t=this;this.listeners.push(e);return function(){t.listeners=t.listeners.filter((function(t){return e!==t}))}}},{key:"setState",value:function(e,t,n){this.cutoffVals[e].co[t]=n}},{key:"onAllConfigsLoaded",value:function(e){for(var t=e,n=0;n<t.length;n++){var i=t[n].name,a=t[n].config;this.configs[i]=a}console.log(this.configs);for(var s=0;s<this.listeners.length;s++)this.listeners[s](this.configs)}},{key:"saveParams",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={},i=0;i<2;i++){for(var a={cutoff:{}},s=0;s<12;s++){var o=this.cutoffVals[i].co;a.cutoff[s]=o[s]}n[i.toString()]=a}var c={name:e,config:JSON.stringify(n)};t?(m.saveUserConfig(c),this.configs[e]=n):(m.updateUserConfig(c),this.configs[e]=n)}},{key:"updateParams",value:function(e){this.saveParams(e,!1)}},{key:"getCutoffValue",value:function(e,t,n){return this.configs[e]?this.configs[e][t].cutoff[n]:this.cutoffVals[t].co[n]}}]),e}()),y={container:{position:"relative",marginLeft:"10px",marginTop:"20px"},configs:{display:"flex",flexDirection:"row",alignItems:"center"},textArea:{marginLeft:"10px",height:"15px"},sensor:{width:"30px",height:"20px",marginRight:"10px",marginTop:"10px"},button:{marginTop:"10px",marginRight:"10px"}},b=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).state={textValue:"",configNames:[],selectVal:"newconfig"},i.selectRef=a.a.createRef(),i}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.removeListener=g.subscribe(this.onConfigsLoaded.bind(this))}},{key:"render",value:function(){var e=this.getOptions();return a.a.createElement("div",{style:y.container},a.a.createElement("div",{style:y.configs},a.a.createElement("select",{value:this.state.selectVal,ref:this.selectRef,onChange:this.onSelectChange.bind(this)},e),a.a.createElement("textarea",{style:y.textArea,value:this.state.textValue,onChange:this.onTextAdded.bind(this),placeholder:"Type config name.."})),a.a.createElement("div",{style:y.buttons},a.a.createElement("button",{style:y.button,onClick:this.onSave.bind(this)},"Save"),a.a.createElement("button",{style:y.button,onClick:this.onDelete.bind(this)},"Delete")))}},{key:"componentWillUnmount",value:function(){this.removeListener()}},{key:"onSave",value:function(){var e=this.selectRef.current.value;if("newconfig"===e)if(this.state.textValue.length>0){g.saveParams(this.state.textValue);var t=this.state.configNames;t.push(this.state.textValue),this.setState({configNames:t,selectVal:this.state.textValue,textValue:""})}else console.warn("Empty config name.");else{var n=e;g.updateParams(n)}}},{key:"onDelete",value:function(){var e=this.selectRef.current.value;m.deleteUserConfig(e);var t=this.state.configNames;p.a.remove(t,(function(t){return e===t})),this.setState({selectVal:"newconfig",configNames:t})}},{key:"onSelectChange",value:function(e){var t=e.target.value;if("newconfig"!==t)for(var n=this.state.configNames,i=0;i<n.length;i++){var a=n[i];if(a===t){this.setState({selectVal:a}),this.props.onConfigSelected&&this.props.onConfigSelected(a);break}}else this.setState({selectVal:t})}},{key:"getOptions",value:function(){var e=[];e.push(a.a.createElement("option",{key:"new",value:"newconfig"},"newconfig"));for(var t=0;t<this.state.configNames.length;t++){var n=this.state.configNames[t];e.push(a.a.createElement("option",{key:n,value:n},n))}return e}},{key:"onTextAdded",value:function(e){this.setState({textValue:e.target.value})}},{key:"onConfigsLoaded",value:function(e){var t=Object.keys(e);this.setState({configNames:t})}}]),n}(a.a.Component),C=Object(h.a)(b),k=n(97),x=n.n(k),E=n(99),S=new(function(){function e(){Object(c.a)(this,e),this.state=[{f:new Array(12).fill(0),b:new Array(12).fill(0)},{f:new Array(12).fill(0),b:new Array(12).fill(0)}],this.listeners=[]}return Object(r.a)(e,[{key:"subscribe",value:function(e){var t=this;this.listeners.push(e);return function(){t.listeners=t.listeners.filter((function(t){return e!==t}))}}},{key:"setState",value:function(e,t,n){console.log("Chipset Idx, Data type, sensor Data: "+e+", "+t+", "+n);for(var i=0;i<n.length;i++){var a=Number(n[i]);this.state[e][t][i]=a}var s,o=Object(E.a)(this.listeners);try{for(o.s();!(s=o.n()).done;){(0,s.value)(this.state)}}catch(c){o.e(c)}finally{o.f()}}},{key:"getChipData",value:function(e){return this.state[e]}}]),e}()),V=new(function(){function e(t){Object(c.a)(this,e),this.myBLE=new x.a,this.myRxCharacteristic="",this.myTxCharacteristic="",this.isReceivingData=!1}return Object(r.a)(e,[{key:"connect",value:function(){this.myBLE.connect("6e400001-b5a3-f393-e0a9-e50e24dcca9e",this.handleCharacteristics.bind(this))}},{key:"disconnect",value:function(){this.myBLE.disconnect()}},{key:"stop",value:function(){""!==this.myRxCharacteristic?(this.myBLE.stopNotifications(this.myRxCharacteristic),this.isReceivingData=!1):console.warn("BLE: Not initialized.")}},{key:"handleCharacteristics",value:function(e,t){e?console.log("error: ",e):(this.myTxCharacteristic=t[0],this.myRxCharacteristic=t[1],console.log(this.myTxCharacteristic),console.log(this.myRxCharacteristic),this.myBLE.startNotifications(this.myRxCharacteristic,this.handleIncomingData.bind(this),"string"),this.isReceivingData=!0,console.log("BLE: Successfully paired. Ready to communicate."))}},{key:"handleIncomingData",value:function(e){var t,n,i,a=(e=e.replace(/\0[\s\S]*$/g,"")).split("-");t=a[0][0],n=a[0][1],i=a[1].split(","),S.setState(t,n,i)}},{key:"sendBuffer",value:function(e){""!==this.myTxCharacteristic?(this.myTxCharacteristic.writeValue(e),console.log("BLE: Buffer sent: "+e)):console.warn("BLE: Ensure Bluetooth is connected.")}}]),e}()),O=n(36),D=n.n(O),w=(n(150),n(98)),j=n.n(w),R=function(e){var t,n;e.preload=function(){t=e.loadSound(j.a)},e.setup=function(){e.noCanvas(),e.background(0),n=new D.a.Envelope(.1,.7,.3,.1)},e.draw=function(){e.noLoop()},e.play=function(){t.stop(),t.loop(),n.triggerAttack(t)}},N=new(function(){function e(){Object(c.a)(this,e),this.myP5=new D.a(R)}return Object(r.a)(e,[{key:"play",value:function(){this.myP5.play()}}]),e}()),L={container:{position:"relative"},input:{width:"40px",height:"20px",marginBottom:"10px",marginTop:"5px"}},A=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).state={cutoffVal:g.getCutoffValue(i.props.configName,i.props.chipsetId,i.props.sensorIdx)},i}return Object(r.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){if(this.props.fVal!==e.fVal||this.props.bVal!==e.bVal||this.props.configName!==e.configName||this.state.cutoffVal!==t.cutoffVal){if(this.props.configName!==e.configName){var n=g.getCutoffValue(e.configName,this.props.chipsetId,this.props.sensorIdx);this.setState({cutoffVal:n})}return!0}return!1}},{key:"render",value:function(){return a.a.createElement("div",{style:L.container},a.a.createElement("div",null,a.a.createElement("span",null,"Sensor Idx "),this.props.sensoridx,a.a.createElement("span",null,", Base Val: "),this.props.bVal,a.a.createElement("span",null,", Filtered Val: "),this.props.fVal),a.a.createElement("span",null,"Cutoff Value: "),a.a.createElement("input",{style:L.input,onChange:this.cutoffChange.bind(this),type:"number",value:this.state.cutoffVal}))}},{key:"cutoffChange",value:function(e){var t=e.target.value;this.setState({cutoffVal:Number(t)}),g.setState(this.props.chipsetId,this.props.sensorIdx,t)}}]),n}(a.a.Component),I=Object(h.a)(A),T={container:{position:"relative",marginTop:"20px",display:"flex",flexDirection:"column"}},B=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).state={chipData:S.getChipData(i.props.chipsetId),configName:""},i}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.removeListener=S.subscribe(this.handleNewSensorData.bind(this))}},{key:"render",value:function(){var e=this.getSensors(),t="Chipset "+this.props.chipsetId;return a.a.createElement("div",{style:T.container},t,e)}},{key:"componentWillUnmount",value:function(){this.removeListener()}},{key:"getSensors",value:function(){for(var e=this.state.chipData.f,t=this.state.chipData.b,n=[],i=0;i<e.length;i++){var s=a.a.createElement(I,{chipsetId:this.props.chipsetId,configName:this.state.configName,sensorIdx:i,fVal:e[i],bVal:t[i],key:"key"+i});n.push(s)}return n}},{key:"handleNewSensorData",value:function(e){var t=e[this.props.chipsetId];this.setState({chipData:t})}},{key:"updateCalibrationParams",value:function(e){this.setState({configName:e})}}]),n}(a.a.Component),P=Object(h.a)(B),U={container:{position:"relative",marginLeft:"10px"}},F=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).state={},i.chipset0Ref=a.a.createRef(),i.chipset1Ref=a.a.createRef(),i}return Object(r.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{style:U.container},a.a.createElement(P,{ref:this.chipset0Ref,key:"zero",chipsetId:0}),a.a.createElement(P,{ref:this.chipset1Ref,key:"one",chipsetId:1}))}},{key:"updateCalibrationParams",value:function(e){this.chipset0Ref.current.updateCalibrationParams(e),this.chipset1Ref.current.updateCalibrationParams(e)}}]),n}(a.a.Component),q=Object(h.a)(F),J={container:{position:"relative",overflow:"scroll"},content:{display:"flex",flexDirection:"column",width:"400px"},inputContainer:{display:"flex",flexDirection:"row"},input:{width:"200px",marginTop:"10px",marginLeft:"10px"},connected:{backgroundColor:"green"}},z=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).state={isConnected:!1,receiveVal:"Receive Text"},i.chipsetCollectionRef=a.a.createRef(),i}return Object(r.a)(n,[{key:"render",value:function(){var e=this.state.isConnected?[J.input,J.connected]:J.input;return a.a.createElement("div",{style:J.content},a.a.createElement("button",{onClick:this.onConnect.bind(this)},"BLE Connect"),a.a.createElement("button",{onClick:this.onDisconnect.bind(this)},"BLE Disconnect"),a.a.createElement("button",{onClick:this.onPlay.bind(this)},"Play Some Audio"),a.a.createElement("div",{style:J.inputContainer},a.a.createElement("input",{onChange:this.onTextAdded.bind(this),style:J.input,type:"text",placeholder:"Transmit text."}),a.a.createElement("div",{style:J.input},this.state.receiveVal)),a.a.createElement("button",{style:e,onClick:this.enableConnect.bind(this)},"Enable Connect"),a.a.createElement(C,{onConfigSelected:this.onConfigSelected.bind(this)}),a.a.createElement(q,{ref:this.chipsetCollectionRef}))}},{key:"onConnect",value:function(){V.connect()}},{key:"onDisconnect",value:function(){V.disconnect()}},{key:"onPlay",value:function(){N.play()}},{key:"enableConnect",value:function(){this.setState({isConnected:!this.state.isConnected}),m.updateRoom(this.onSensorDataReceived.bind(this))}},{key:"onTextAdded",value:function(e){var t=e.target.value;m.broadcastText(t)}},{key:"onSensorDataReceived",value:function(e){console.log("Sensor Data received: "+e),this.setState({receiveVal:e})}},{key:"onConfigSelected",value:function(e){this.chipsetCollectionRef.current.updateCalibrationParams(e)}}]),n}(a.a.Component),M=Object(h.a)(z),W=n(45);o.a.render(a.a.createElement(W.a,null,a.a.createElement(M,null)),document.getElementById("root"))},98:function(e,t,n){e.exports=n.p+"static/media/testsound.1f40cfce.wav"}},[[100,1,2]]]);
//# sourceMappingURL=main.4ba6ac2b.chunk.js.map